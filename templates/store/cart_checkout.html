{% extends 'layouts/base.html' %}

{% load django_bootstrap5 grid_tags static %}

{% block title %}Confirmar Pedido{% endblock %}


{% block content %}
<!-- Cart Confirm Section -->
<section class="py-4">
  {% container 'px-4' %}
    {% row %}
      {% col 'col-12' %}
        <h3 class="mb-5 text-start">Confirmar Pedido</h3>
      {% endcol %}
    {% endrow %}
    {% row 'gx-3' %}
      {% col 'col-12 col-md-7' %}
        <!-- Cart Items List -->
        <ul class="list-group list-group-lg list-group-flush mb-6">
          {% for item in cart_items %}                
          <li class="list-group-item">
            <div class="row align-items-center">
              <div class="col-3">
                <!-- Img -->
                <img class="img-fluid" src="{{ item.pizza.photo_main.url }}" width="128" height="128" alt="Carrinho Item Imagem">
              </div>
              <div class="col">
                <!-- Product Description -->
                <div class="d-flex mb-2 fw-bold">
                  <h5 class="text-body">{{ item.pizza.name }}</h5>
                  <span class="ms-auto">{{ item.pizza.price }}</span>
                </div>
                <!-- Form Footer -->
                <div class="d-flex align-items-center">
                  <p class="mt-7 fs-sm text-muted">Qtd:{{ item.quantity }}</p>
                  <a class="fs-xs text-gray-400 ms-auto" href="#">
                    <img src="{% static 'icons/x.svg' %}" width="32" height="32" alt="Carrinho Vazio"> 
                    Excluir
                  </a>
                </div>
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>
      {% endcol %}
      {% col 'col-12 col-md-5 col-lg-4 offset-lg-1' %}
        <div class="card text-center mb-3 border-0 bg-light">
          <div class="card-body pt-0">
            <ul class="list-group list-group-sm">
              {% for item in cart_items %}                
                <li class="list-group-item d-flex">
                  <span>{{ item.pizza.name }}</span>
                  <span class="ms-auto fs-sm">R$ {{ item.get_cart_item_subtotal }}</span>
                </li>
              {% endfor %}                
              <li class="list-group-item d-flex fs-lg fw-bold">
                <span>Subtotal: R$</span>
                <span class="ms-auto fs-sm">{{ cart_total }}
                </span>
              </li>
            </ul>
            
            <div class="mt-4">
              <form method="post" action="">
                {% csrf_token %}
                {{ form.non_field_errors }}
           
                    <div class="mb-3">
                      <div id="id_is_shipping" role="group">
                        {% for radio in form.is_shipping %}
                          <input type="radio" class="form-check-input btn-check" name="is_shipping" id="{{ radio.id_for_label }}" value="{{ radio.value }}" {% if radio.value == form.initial.is_shipping %}checked="checked"{% endif %} required>
                          <label class="btn btn-outline-dark" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                        {% endfor %}
                      </div>
                    </div>

                <div class="mb-3 text-start" id="shipping-address-field" style="display: none;">
                    {% bootstrap_field form.shipping_address %}
                </div>
                <div class="mb-3 text-start">
                    {% bootstrap_field form.payment_method %}
                </div>
                <div class="mb-3">
                    {% bootstrap_field form.observation show_label=False %}
                </div>
                <div class="mb-3">
                  {% bootstrap_button button_type="submit" button_class="btn btn-dark w-75" content="Finalizar Pedido" %} 
                </div>
              </form>              
            </div>
          </div>
        </div>
      {% endcol %}
    {% endrow %}
  {% endcontainer %}
</section>  
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const shippingOptionButtons = document.querySelectorAll('#id_is_shipping .btn');
            const shippingAddressField = document.getElementById('shipping-address-field');

            shippingOptionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const radioButton = document.getElementById(button.getAttribute('for'));
                    radioButton.checked = true;
                    if (radioButton.value === 'True') {
                        shippingAddressField.style.display = 'block';
                    } else {
                        shippingAddressField.style.display = 'none';
                    }
                });
            });

            // Trigger change event on page load to set the initial state
            const selectedOption = document.querySelector('input[name="is_shipping"]:checked');
            if (selectedOption) {
                selectedOption.dispatchEvent(new Event('change'));
            }
        });
    </script>


{% endblock content %}